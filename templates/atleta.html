<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ Ter√ßa Nobre - An√°lise de Atleta</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/atleta.css') }}">
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="brand-icon">‚öΩ</span>
                <span class="brand-text">Ter√ßa Nobre</span>
            </div>
            <ul class="nav-menu">
                <li><a href="{{ url_for('dashboard') }}"         class="nav-link">Dashboard</a></li>
                <li><a href="{{ url_for('classificar_times') }}" class="nav-link">Classificar</a></li>
                <li><a href="{{ url_for('elenco') }}"            class="nav-link">Elenco</a></li>
                <li><a href="/captura"                           class="nav-link">Captura</a></li>
                <li><a href="/atleta"                            class="nav-link active">Atleta</a></li>
            </ul>
        </div>
    </nav>

    <main class="page-atleta">

        <header class="page-header">
            <h1>üîç An√°lise de Atleta</h1>
            <p class="subtitle">Reconhecimento individual + mapa de calor ‚Äî one-shot, sem retreino</p>
        </header>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             WORKSPACE LAYOUT (sidebar + main, Azure CV)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="cv-workspace">

            <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <aside class="cv-sidebar">

                <div class="sb-section">
                    <div class="sb-section-title">Atleta</div>
                    <div class="field-group" style="margin-bottom:0.5rem;">
                        <input type="text" id="nome-atleta" class="field-input"
                               placeholder="Nome do atleta‚Ä¶">
                    </div>
                    <div id="atletas-salvos" class="atletas-salvos hidden">
                        <div class="atletas-label">Embeddings salvos</div>
                        <div id="atletas-lista" class="atletas-lista"></div>
                    </div>
                </div>

                <hr class="sb-divider">

                <div class="sb-section">
                    <div class="sb-section-title">Fotos de Refer√™ncia</div>
                    <div class="upload-zone" id="upload-zone"
                         onclick="document.getElementById('fotos-input').click()">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">Adicionar imagens</div>
                        <div class="upload-hint">JPG / PNG ‚Äî m√≠n. 5 recomendado</div>
                        <input type="file" id="fotos-input" multiple accept="image/*" hidden>
                    </div>
                    <div id="fotos-preview" class="fotos-preview hidden"></div>
                    <button class="btn btn-primary btn-full" id="btn-gerar-embedding" disabled
                            style="margin-top:0.5rem;">
                        Gerar Embedding
                    </button>
                    <div id="status-embedding" class="status-msg hidden" style="margin-top:0.5rem;"></div>
                </div>

                <hr class="sb-divider">

                <div class="sb-section">
                    <div class="sb-section-title">Configura√ß√µes</div>
                    <div class="threshold-group" style="margin-bottom:0;">
                        <label for="threshold-range">
                            Limiar an√°lise: <strong id="threshold-val">0.72</strong>
                        </label>
                        <input type="range" id="threshold-range"
                               min="0.50" max="0.95" step="0.01" value="0.72"
                               class="threshold-range">
                        <div class="threshold-desc">
                            <span>‚Üì mais detec√ß√µes</span>
                            <span>‚Üë mais preciso</span>
                        </div>
                    </div>
                </div>

                <hr class="sb-divider">

                <div class="sb-section" id="sb-stats" style="display:none;">
                    <div class="sb-section-title">√öltimo Resultado</div>
                    <div class="sb-stat-row">
                        <span class="sb-stat-val" id="sb-res-matches">‚Äî</span>
                        <span class="sb-stat-lbl">Detec√ß√µes</span>
                    </div>
                    <div class="sb-stat-row">
                        <span class="sb-stat-val" id="sb-res-taxa">‚Äî</span>
                        <span class="sb-stat-lbl">Taxa</span>
                    </div>
                    <div class="sb-stat-row">
                        <span class="sb-stat-val" id="sb-res-frames">‚Äî</span>
                        <span class="sb-stat-lbl">Frames analisados</span>
                    </div>
                </div>

            </aside>

            <!-- ‚îÄ‚îÄ MAIN PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div class="cv-main">

                <!-- Tab bar -->
                <div class="cv-tabbar">
                    <button class="cv-tab active" data-tab="tab-fotos" onclick="mudarTab(this)">
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"/></svg>
                        Fotos de Refer√™ncia
                    </button>
                    <button class="cv-tab" data-tab="tab-analise" onclick="mudarTab(this)">
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/></svg>
                        An√°lise de V√≠deo
                    </button>
                    <button class="cv-tab" data-tab="tab-resultado" onclick="mudarTab(this)" id="tab-btn-resultado">
                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zm6-4a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zm6-3a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
                        Resultado
                    </button>
                </div>

                <!-- ‚îÄ‚îÄ‚îÄ TAB 1: FOTOS DE REFER√äNCIA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <div class="cv-tab-content" id="tab-fotos">

                    <!-- Toolbar estilo Azure CV -->
                    <div class="cv-toolbar">
                        <div class="cv-toolbar-left">
                            <button class="cv-toolbar-btn" id="btn-toggle-extrator"
                                    onclick="toggleExtrator()">
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zm12.553 1.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/></svg>
                                Extrair do v√≠deo
                            </button>
                            <button class="cv-toolbar-btn" id="btn-capturar-refs"
                                    onclick="capturarRefs()">
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"/></svg>
                                Capturar automaticamente
                            </button>
                            <button class="cv-toolbar-btn" id="btn-testar-rastreamento"
                                    onclick="testarRastreamento()">
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/></svg>
                                Testar rastreamento
                            </button>
                            <button class="cv-toolbar-btn" id="btn-ver-fotos-salvas"
                                    onclick="verFotosSalvas()" style="display:none;">
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/></svg>
                                <span id="btn-ver-fotos-label">Ver fotos salvas</span>
                            </button>
                        </div>
                        <div id="revisao-counter-top" style="font-size:13px;color:var(--text-muted);padding:0 16px;align-self:center;"></div>
                    </div>

                    <!-- Progresso captura autom√°tica -->
                    <div id="captura-refs-progress" style="display:none;padding:10px 20px;
                         background:#fafafa;border-bottom:1px solid var(--border);">
                        <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                            <span style="font-size:13px;font-weight:600;" id="captura-refs-label">Iniciando‚Ä¶</span>
                            <span style="font-size:13px;color:var(--accent);" id="captura-refs-count">0 salvos</span>
                        </div>
                        <div style="background:var(--border);border-radius:4px;height:4px;">
                            <div id="captura-refs-bar" style="height:4px;border-radius:4px;
                                 background:var(--accent);transition:width .4s;width:0%;"></div>
                        </div>
                    </div>

                    <!-- Se√ß√£o do extrator (aparece ao clicar) -->
                    <div id="extrator-section" style="display:none;padding:16px 20px;
                         background:#fafafa;border-bottom:1px solid var(--border);">
                        <p style="font-size:13px;color:var(--text-muted);margin-bottom:12px;">
                            Cole a URL do YouTube (ou arquivo local) e navegue at√© um frame onde o atleta esteja vis√≠vel.
                            Clique na caixa verde para adicionar como refer√™ncia.
                        </p>
                        <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;">
                            <div class="field-group" style="flex:3;min-width:200px;margin-bottom:0;">
                                <label>URL YouTube ou nome do arquivo</label>
                                <input type="text" id="extrator-src" class="field-input"
                                       placeholder="https://youtube.com/watch?v=‚Ä¶ ou jogo.mp4">
                            </div>
                            <div class="field-group" style="flex:1;min-width:90px;margin-bottom:0;">
                                <label>Tempo (s)</label>
                                <input type="number" id="extrator-ts" class="field-input"
                                       value="30" min="0" step="5">
                            </div>
                            <div class="field-group" style="flex:1.5;min-width:130px;margin-bottom:0;">
                                <label>Limiar: <strong id="extrator-threshold-val" style="color:var(--accent);">0.65</strong></label>
                                <input type="range" id="extrator-threshold" class="threshold-range"
                                       min="0.40" max="0.90" step="0.01" value="0.65"
                                       oninput="document.getElementById('extrator-threshold-val').textContent=parseFloat(this.value).toFixed(2)">
                            </div>
                            <button class="btn btn-secondary" id="btn-extrair-frame"
                                    onclick="extrairFrame()" style="margin-bottom:0;">
                                Extrair Frame
                            </button>
                        </div>

                        <div id="extrator-canvas-wrap"
                             style="display:none;position:relative;margin-top:12px;line-height:0;
                                    border-radius:8px;overflow:hidden;border:1px solid var(--border);">
                            <canvas id="extrator-canvas" style="width:100%;cursor:crosshair;display:block;"></canvas>
                            <div id="extrator-hint"
                                 style="position:absolute;top:8px;left:0;right:0;text-align:center;pointer-events:none;">
                                <span style="background:rgba(0,0,0,.65);color:#86efac;
                                             padding:4px 10px;border-radius:20px;font-size:12px;">
                                    Clique numa caixa verde para adicionar como refer√™ncia
                                </span>
                            </div>
                        </div>
                        <div id="extrator-status" style="margin-top:8px;font-size:13px;color:var(--text-muted);"></div>
                        <div id="extrator-crops" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;"></div>
                    </div>

                    <!-- ‚îÄ‚îÄ GALERIA DE REVIS√ÉO (estilo Azure CV) ‚îÄ‚îÄ -->
                    <div id="captura-refs-revisao" style="display:none;height:100%;">

                        <!-- Toolbar da galeria -->
                        <div class="gallery-toolbar">
                            <div class="gallery-toolbar-left">
                                <button class="cv-toolbar-btn cv-toolbar-btn--primary"
                                        onclick="_selecionarVisiveis(true)">
                                    <svg width="12" height="12" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    Selecionar vis√≠veis
                                </button>
                                <button class="cv-toolbar-btn"
                                        onclick="_selecionarVisiveis(false)">
                                    <svg width="12" height="12" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                                    Desselecionar
                                </button>
                                <div class="gallery-sep"></div>
                                <button class="cv-toolbar-btn cv-toolbar-btn--success"
                                        id="btn-confirmar-revisao" onclick="confirmarCaptura()">
                                    Confirmar selecionadas
                                </button>
                                <button class="cv-toolbar-btn cv-toolbar-btn--danger"
                                        onclick="cancelarCaptura()">
                                    Descartar tudo
                                </button>
                            </div>
                            <div class="gallery-toolbar-right" id="revisao-counter"></div>
                        </div>

                        <!-- Painel com filtros laterais + grade -->
                        <div class="gallery-body">

                            <!-- Filtros (sidebar da galeria) -->
                            <div class="gallery-filters">
                                <div class="gf-title">Filtrar por cor</div>
                                <div id="revisao-cor-chips" class="gf-chips"></div>

                                <div class="gf-title" style="margin-top:16px;">Similaridade m√≠nima</div>
                                <div style="display:flex;align-items:center;gap:8px;margin-top:4px;">
                                    <input type="range" id="revisao-sim-range" min="0.60" max="0.95"
                                           step="0.01" value="0.65"
                                           style="flex:1;accent-color:var(--accent);"
                                           oninput="document.getElementById('revisao-sim-val').textContent=parseFloat(this.value).toFixed(2);_aplicarFiltrosRevisao()">
                                    <strong id="revisao-sim-val" style="font-size:13px;min-width:32px;">0.65</strong>
                                </div>

                                <div class="gf-title" style="margin-top:16px;">Ajuda</div>
                                <div class="gf-help">
                                    <div>üñ± Clique na foto para rejeitar</div>
                                    <div>üü¢ Verde = selecionada</div>
                                    <div>üî¥ Vermelho = rejeitada</div>
                                    <div>Ctrl+clique = adicionar uma cor</div>
                                </div>
                            </div>

                            <!-- Grade de imagens -->
                            <div class="gallery-grid-wrap">
                                <div id="revisao-grid" class="gallery-grid"></div>
                            </div>

                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ FOTOS SALVAS DO ATLETA ‚îÄ‚îÄ -->
                    <div id="fotos-salvas-section" style="display:none;height:100%;flex-direction:column;">

                        <!-- Toolbar galeria salvas -->
                        <div class="gallery-toolbar">
                            <div class="gallery-toolbar-left">
                                <span style="font-size:13px;font-weight:600;">Fotos de refer√™ncia salvas</span>
                                <div class="gallery-sep"></div>
                                <span id="fotos-salvas-counter" style="font-size:12.5px;color:var(--text-muted);">0 fotos</span>
                            </div>
                            <div class="gallery-toolbar-right">
                                <button class="cv-toolbar-btn" id="btn-filtro-auto"
                                        onclick="filtrarBorradasAuto()">
                                    üîç Filtrar borradas
                                </button>
                                <button class="cv-toolbar-btn cv-toolbar-btn--accent"
                                        onclick="iniciarClassificacaoRapida()">
                                    ‚ö° Classifica√ß√£o r√°pida
                                </button>
                                <button class="cv-toolbar-btn cv-toolbar-btn--danger"
                                        onclick="fecharFotosSalvas()">
                                    ‚úï Fechar
                                </button>
                            </div>
                        </div>

                        <!-- Grade das fotos salvas -->
                        <div class="gallery-grid-wrap" style="flex:1;">
                            <div id="fotos-salvas-grid" class="gallery-grid"></div>
                        </div>

                    </div>

                    <!-- ‚îÄ‚îÄ CLASSIFICA√á√ÉO R√ÅPIDA ‚îÄ‚îÄ -->
                    <div id="classif-rapida-section" style="display:none;height:100%;flex-direction:column;">

                        <!-- Toolbar classifica√ß√£o -->
                        <div class="gallery-toolbar">
                            <div class="gallery-toolbar-left">
                                <span style="font-size:13px;font-weight:600;" id="classif-titulo">Classifica√ß√£o r√°pida</span>
                                <div class="gallery-sep"></div>
                                <span id="classif-progresso" style="font-size:12.5px;color:var(--text-muted);">0 / 0</span>
                                <div class="gallery-sep"></div>
                                <span id="classif-stats" style="font-size:12px;color:var(--text-muted);">‚úì 0 &nbsp; ‚úó 0</span>
                            </div>
                            <div class="gallery-toolbar-right">
                                <button class="cv-toolbar-btn" onclick="_classifSair()">‚Üê Voltar ao grid</button>
                            </div>
                        </div>

                        <!-- Barra de progresso -->
                        <div style="height:3px;background:var(--border);">
                            <div id="classif-barra" style="height:3px;background:var(--accent);width:0%;transition:width .2s;"></div>
                        </div>

                        <!-- Imagem central -->
                        <div class="classif-stage">
                            <div class="classif-img-wrap">
                                <img id="classif-img" src="" alt="">
                                <img id="classif-img-preload" src="" alt="" style="display:none;">
                            </div>
                            <div id="classif-nome" class="classif-nome"></div>
                            <div class="classif-btns">
                                <button class="classif-btn classif-btn--del" onclick="_classifDeletar()">
                                    <span class="classif-btn-icon">‚úó</span>
                                    <span class="classif-btn-label">Deletar</span>
                                    <span class="classif-btn-key">‚Üê Del</span>
                                </button>
                                <button class="classif-btn classif-btn--ok" onclick="_classifManter()">
                                    <span class="classif-btn-icon">‚úì</span>
                                    <span class="classif-btn-label">Manter</span>
                                    <span class="classif-btn-key">‚Üí Space</span>
                                </button>
                            </div>
                        </div>

                    </div>

                    <!-- Estado ocioso da tab de fotos -->
                    <div id="fotos-idle" class="tab-idle">
                        <div class="idle-icon">üì∑</div>
                        <div class="idle-text">
                            Use <strong>Extrair do v√≠deo</strong> para navegar frame a frame<br>
                            ou <strong>Capturar automaticamente</strong> para varrer o v√≠deo
                        </div>
                    </div>

                </div><!-- /tab-fotos -->

                <!-- ‚îÄ‚îÄ‚îÄ TAB 2: AN√ÅLISE DE V√çDEO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <div class="cv-tab-content hidden" id="tab-analise">
                    <div style="padding:24px;max-width:680px;">

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                            <div class="field-group">
                                <label for="atleta-select">Atleta</label>
                                <select id="atleta-select" class="field-input">
                                    <option value="">‚Äî selecione um atleta ‚Äî</option>
                                </select>
                            </div>
                            <div class="field-group">
                                <label for="video-select">V√≠deo dispon√≠vel</label>
                                <select id="video-select" class="field-input">
                                    {% if videos %}
                                        {% for v in videos %}
                                        <option value="{{ v }}">{{ v }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="">Nenhum v√≠deo dispon√≠vel</option>
                                    {% endif %}
                                </select>
                            </div>
                        </div>

                        <div class="field-group yt-group">
                            <label>Ou cole um link do YouTube</label>
                            <div class="yt-input-row">
                                <input type="text" id="yt-url-atleta" class="field-input"
                                       placeholder="https://youtube.com/watch?v=...">
                                <button class="btn btn-secondary" id="btn-buscar-yt">Buscar</button>
                            </div>
                            <div id="yt-info-atleta" class="yt-info hidden">
                                <img id="yt-thumb" src="" alt="">
                                <div class="yt-meta">
                                    <div id="yt-titulo" class="yt-titulo"></div>
                                    <div id="yt-duracao" class="yt-duracao"></div>
                                </div>
                                <button class="btn btn-primary yt-usar" id="btn-usar-stream">&#9654; Usar</button>
                            </div>
                            <div id="yt-erro-atleta" class="yt-erro hidden"></div>
                            <div id="yt-selecionado" class="yt-selecionado hidden"></div>
                        </div>

                        <button class="btn btn-primary btn-full" id="btn-analisar" style="margin-top:8px;">
                            ‚ñ∂ Iniciar An√°lise
                        </button>

                    </div>
                </div><!-- /tab-analise -->

                <!-- ‚îÄ‚îÄ‚îÄ TAB 3: RESULTADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <div class="cv-tab-content hidden" id="tab-resultado">
                    <div style="padding:24px;">

                        <!-- Progresso -->
                        <div id="progresso-section" class="hidden">
                            <div class="progresso-label">
                                <span id="progresso-texto">Analisando...</span>
                                <span id="progresso-pct">0%</span>
                            </div>
                            <div class="progresso-bar" style="margin-bottom:0.75rem;">
                                <div class="progresso-fill" id="progresso-fill" style="width:0%"></div>
                            </div>
                            <div class="progresso-stats">
                                <span>Frame: <strong id="stat-frame">-</strong></span>
                                <span>Matches: <strong id="stat-matches">-</strong></span>
                            </div>
                            <div style="margin-top:16px;">
                                <p style="font-size:12px;color:var(--text-muted);margin-bottom:6px;">
                                    üëÅ Vis√£o do algoritmo ‚Äî <span style="color:#facc15;">laranja = match</span>, cinza = descartado
                                </p>
                                <img id="preview-frame" src="" alt=""
                                     style="width:100%;max-width:720px;border-radius:8px;
                                            border:1px solid var(--border);display:none;background:#000;">
                            </div>
                        </div>

                        <!-- Heatmap -->
                        <div id="heatmap-section" class="hidden">
                            <div class="heatmap-stats">
                                <div class="hstat"><span class="hstat-valor" id="res-matches">-</span><span class="hstat-label">Detec√ß√µes do atleta</span></div>
                                <div class="hstat"><span class="hstat-valor" id="res-frames">-</span><span class="hstat-label">Frames total</span></div>
                                <div class="hstat"><span class="hstat-valor" id="res-taxa">-</span><span class="hstat-label">Taxa de detec√ß√£o</span></div>
                            </div>
                            <div class="heatmap-container">
                                <img id="heatmap-img" src="" alt="Mapa de Calor do atleta">
                            </div>
                            <div id="zonas-wrap" style="margin:20px 0;">
                                <h4 style="color:var(--text-muted);font-size:13px;font-weight:600;
                                           text-transform:uppercase;letter-spacing:.05em;margin-bottom:10px;">
                                    Distribui√ß√£o por Zona
                                </h4>
                                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;max-width:480px;">
                                    <div class="zona-cell" id="z-def_esq"><span class="zona-label">Def-Esq</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-mei_esq"><span class="zona-label">Meio-Esq</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-ata_esq"><span class="zona-label">Atq-Esq</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-def_cen"><span class="zona-label">Def-Cen</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-mei_cen"><span class="zona-label">Meio-Cen</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-ata_cen"><span class="zona-label">Atq-Cen</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-def_dir"><span class="zona-label">Def-Dir</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-mei_dir"><span class="zona-label">Meio-Dir</span><span class="zona-pct">-</span></div>
                                    <div class="zona-cell" id="z-ata_dir"><span class="zona-label">Atq-Dir</span><span class="zona-pct">-</span></div>
                                </div>
                            </div>
                            <div class="heatmap-actions">
                                <a id="btn-baixar" class="btn btn-secondary" download>‚¨á Baixar PNG</a>
                                <a id="btn-baixar-csv" class="btn btn-secondary" download style="display:none;">üìä Exportar CSV</a>
                                <button class="btn btn-outline" id="btn-nova-analise">Nova an√°lise</button>                                <button class="btn btn-outline" onclick="calibrarThreshold()" id="btn-calibrar-limiar">üìà Calibrar limiar</button>
                                <button class="btn btn-outline" onclick="mostrarMatrizConfusao()" id="btn-matriz-confusao">üîÄ Matriz de confus√£o</button>
                            </div>

                            <!-- ‚îÄ Painel Calibra√ß√£o ‚îÄ -->
                            <div id="calibrar-painel" class="hidden" style="margin-top:24px;background:var(--surface-2);border-radius:12px;padding:20px;border:1px solid var(--border);">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                    <h4 style="margin:0;font-size:15px;">üìà Curva Precis√£o √ó Recall</h4>
                                    <button onclick="document.getElementById('calibrar-painel').classList.add('hidden')" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:18px;">√ó</button>
                                </div>
                                <div id="calibrar-loading" style="text-align:center;padding:32px;color:var(--text-muted);">Calculando‚Ä¶ (pode levar alguns segundos)</div>
                                <div id="calibrar-resultado" class="hidden">
                                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;">
                                        <div style="background:var(--surface);border-radius:8px;padding:12px;text-align:center;">
                                            <div style="font-size:22px;font-weight:700;color:#22c55e;" id="cal-best-t">-</div>
                                            <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">Threshold √≥timo (F1)</div>
                                        </div>
                                        <div style="background:var(--surface);border-radius:8px;padding:12px;text-align:center;">
                                            <div style="font-size:22px;font-weight:700;" id="cal-best-f1">-</div>
                                            <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">Melhor F1-score</div>
                                        </div>
                                        <div style="background:var(--surface);border-radius:8px;padding:12px;text-align:center;">
                                            <div style="font-size:22px;font-weight:700;" id="cal-n-pos">-</div>
                                            <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">Fotos positivas</div>
                                        </div>
                                    </div>
                                    <div style="overflow-x:auto;">
                                        <table id="cal-tabela" style="width:100%;border-collapse:collapse;font-size:12px;">
                                            <thead>
                                                <tr style="color:var(--text-muted);">
                                                    <th style="padding:6px 10px;text-align:left;">Threshold</th>
                                                    <th style="padding:6px 10px;text-align:right;">Precision</th>
                                                    <th style="padding:6px 10px;text-align:right;">Recall</th>
                                                    <th style="padding:6px 10px;text-align:right;">F1-score</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cal-tabela-body"></tbody>
                                        </table>
                                    </div>
                                    <p id="cal-aviso-neg" class="hidden" style="margin-top:12px;font-size:12px;color:var(--text-muted);padding:8px;background:rgba(234,179,8,.1);border-radius:6px;">
                                        ‚ö†Ô∏è Sem outros atletas cadastrados ‚Äî negativos sint√©ticos usados.
                                        Para resultados mais precisos, adicione outros atletas ao sistema.
                                    </p>
                                </div>
                            </div>

                            <!-- ‚îÄ Painel Matriz de Confus√£o ‚îÄ -->
                            <div id="matriz-painel" class="hidden" style="margin-top:24px;background:var(--surface-2);border-radius:12px;padding:20px;border:1px solid var(--border);">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                    <h4 style="margin:0;font-size:15px;">üîÄ Matriz de Similaridade entre Atletas</h4>
                                    <button onclick="document.getElementById('matriz-painel').classList.add('hidden')" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:18px;">√ó</button>
                                </div>
                                <div id="matriz-loading" style="text-align:center;padding:32px;color:var(--text-muted);">Calculando‚Ä¶</div>
                                <div id="matriz-resultado" class="hidden">
                                    <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px;">
                                        Cada c√©lula mostra a similaridade coseno m√©dia das fotos do atleta da linha contra o embedding do atleta da coluna.<br>
                                        Diagonal = auto-similaridade (‚âà maior). Valores altos fora da diagonal indicam atletas visuais similares.
                                    </p>
                                    <div id="matriz-tabela-wrap" style="overflow-x:auto;"></div>
                                </div>                            </div>
                        </div>

                        <!-- Estado ocioso -->
                        <div id="resultado-idle" class="tab-idle">
                            <div class="idle-icon">üî•</div>
                            <div class="idle-text">O mapa de calor aparecer√° aqui ap√≥s a an√°lise</div>
                        </div>

                    </div>
                </div><!-- /tab-resultado -->

            </div><!-- /cv-main -->
        </div><!-- /cv-workspace -->
    </main>

    <div id="toast" class="toast hidden"></div>
    <script src="{{ url_for('static', filename='js/atleta.js') }}"></script>
</body>
</html>
