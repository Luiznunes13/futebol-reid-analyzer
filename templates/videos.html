<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Captura ‚Äî Ter√ßa Nobre</title>
  <link rel="stylesheet" href="/static/css/theme.css" />
  <link rel="stylesheet" href="/static/css/videos.css" />
</head>
<body>

  <!-- ======================== NAVBAR ======================== -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <span class="brand-icon">‚öΩ</span>
        <span class="brand-text">Ter√ßa Nobre</span>
      </div>
      <div class="nav-links">
        <a href="/" class="nav-link">Dashboard</a>
        <a href="/classificar" class="nav-link">Classificar</a>
        <a href="/elenco" class="nav-link">Elenco</a>
        <a href="/captura" class="nav-link active">Captura</a>
        <a href="/atleta" class="nav-link">Atleta</a>
      </div>
    </div>
  </nav>

  <!-- ====================== PAGE HEADER ===================== -->
  <div class="page-header">
    <h1 class="page-title">Captura de Imagens</h1>
    <p class="page-subtitle">Selecione os v√≠deos, configure e extraia fotos dos jogadores</p>
  </div>

  <!-- ======================== MAIN ========================== -->
  <div class="videos-container">

    <!-- ---- Toast ---- -->
    <div id="toast" class="toast hidden"></div>

    <!-- ‚ïê‚ïê‚ïê ETAPA 1 ‚Äî Selecionar v√≠deos ‚ïê‚ïê‚ïê -->
    <div class="step-section" id="step-1">
      <div class="step-header">
        <div class="step-number-badge">1</div>
        <div class="step-info">
          <div class="step-title">Selecionar v√≠deos</div>
          <div class="step-desc">Escolha um v√≠deo para cada c√¢mera ‚Äî YouTube ou arquivo local</div>
        </div>
      </div>

      <!-- Toggle dual-cam -->
      <div class="dual-cam-row">
        <label class="dual-cam-toggle">
          <input type="checkbox" id="toggle-dual-cam" onchange="toggleDualCam(this.checked)" />
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
          <span class="toggle-label">Usar dois v√≠deos (c√¢meras diferentes)</span>
        </label>
        <span class="dual-cam-hint" id="dual-cam-hint">Modo atual: <strong>1 v√≠deo</strong> (mesmo arquivo para ESQ e DIR)</span>
      </div>

    <!-- ---- C√¢meras ---- -->
    <div class="cameras-grid" id="cameras-grid">

      <!-- C√¢mera ESQ -->
      <div class="camera-card" id="card-esq">
        <div class="camera-header esq">
          <span class="camera-icon">‚ë†</span>
          <div>
            <div class="camera-label">C√¢mera 1</div>
            <div class="camera-sublabel">Time 1</div>
          </div>
        </div>

        <div class="camera-body">
          <!-- Fonte: YouTube -->
          <div class="source-tabs">
            <button class="source-tab active" data-cam="esq" data-source="youtube" onclick="setSource('esq','youtube')">YouTube</button>
            <button class="source-tab"        data-cam="esq" data-source="local"   onclick="setSource('esq','local')">Arquivo local</button>
          </div>

          <!-- Painel YouTube -->
          <div class="source-panel" id="esq-panel-youtube">
            <div class="url-row">
              <input type="text" id="esq-url" class="url-input" placeholder="Cole a URL do YouTube..." />
              <button class="btn-buscar" onclick="buscarInfo('esq')">üîç Buscar</button>
            </div>
            <div id="esq-info" class="video-info hidden">
              <img id="esq-thumb" src="" alt="" class="video-thumb" />
              <div class="video-meta">
                <div id="esq-title"    class="video-title"></div>
                <div id="esq-uploader" class="video-uploader"></div>
                <div id="esq-duration" class="video-duration"></div>
              </div>
            </div>
            <div class="yt-actions">
              <button class="btn-stream" id="esq-btn-stream" onclick="usarStream('esq')" disabled>‚ñ∂ Usar stream</button>
              <span class="dl-hint">Stream = sem download, mas pode travar em v√≠deos longos</span>
            </div>
          </div>

          <!-- Painel Local -->
          <div class="source-panel hidden" id="esq-panel-local">
            <button class="btn-browse" id="esq-btn-browse" onclick="escolherArquivo('esq')">
              üìÇ Procurar no computador‚Ä¶
            </button>
          </div>

          <!-- Selecionado -->
          <div id="esq-selected" class="selected-badge hidden">
            <span class="selected-icon">‚úÖ</span>
            <span id="esq-selected-name" class="selected-name"></span>
            <button class="selected-clear" onclick="limparSelecao('esq')">‚úï</button>
          </div>
        </div>
      </div><!-- /card-esq -->

      <!-- C√¢mera DIR -->
      <div class="camera-card" id="card-dir">
        <div class="camera-header dir">
          <span class="camera-icon">‚ë°</span>
          <div>
            <div class="camera-label">C√¢mera 2</div>
            <div class="camera-sublabel">Time 2</div>
          </div>
        </div>

        <div class="camera-body">
          <div class="source-tabs">
            <button class="source-tab active" data-cam="dir" data-source="youtube" onclick="setSource('dir','youtube')">YouTube</button>
            <button class="source-tab"        data-cam="dir" data-source="local"   onclick="setSource('dir','local')">Arquivo local</button>
          </div>

          <div class="source-panel" id="dir-panel-youtube">
            <div class="url-row">
              <input type="text" id="dir-url" class="url-input" placeholder="Cole a URL do YouTube..." />
              <button class="btn-buscar" onclick="buscarInfo('dir')">üîç Buscar</button>
            </div>
            <div id="dir-info" class="video-info hidden">
              <img id="dir-thumb" src="" alt="" class="video-thumb" />
              <div class="video-meta">
                <div id="dir-title"    class="video-title"></div>
                <div id="dir-uploader" class="video-uploader"></div>
                <div id="dir-duration" class="video-duration"></div>
              </div>
            </div>
            <div class="yt-actions">
              <button class="btn-stream" id="dir-btn-stream" onclick="usarStream('dir')" disabled>‚ñ∂ Usar stream</button>
              <span class="dl-hint">Stream = sem download, mas pode travar em v√≠deos longos</span>
            </div>
          </div>

          <div class="source-panel hidden" id="dir-panel-local">
            <button class="btn-browse" id="dir-btn-browse" onclick="escolherArquivo('dir')">
              üìÇ Procurar no computador‚Ä¶
            </button>
          </div>

          <div id="dir-selected" class="selected-badge hidden">
            <span class="selected-icon">‚úÖ</span>
            <span id="dir-selected-name" class="selected-name"></span>
            <button class="selected-clear" onclick="limparSelecao('dir')">‚úï</button>
          </div>
        </div>
      </div><!-- /card-dir -->

    </div><!-- /cameras-grid -->
    </div><!-- /step-1 -->

    <!-- ‚ïê‚ïê‚ïê ETAPA 2 ‚Äî Configura√ß√µes ‚ïê‚ïê‚ïê -->
    <div class="step-section" id="step-2">
      <div class="step-header">
        <div class="step-number-badge">2</div>
        <div class="step-info">
          <div class="step-title">Configura√ß√µes</div>
          <div class="step-desc">Ajuste o modelo de detec√ß√£o, a sensibilidade e a pasta de sa√≠da</div>
        </div>
      </div>

      <div class="config-grid">

        <div class="config-field">
          <label class="config-label" for="cfg-model">Modelo YOLO</label>
          <select id="cfg-model" class="config-select">
            <option value="yolo11n.pt" selected>yolo11n ‚Äî Nano (r√°pido, leve)</option>
            <option value="yolo11s.pt">yolo11s ‚Äî Small (equilibrado)</option>
            <option value="yolo11m.pt">yolo11m ‚Äî Medium (preciso, lento)</option>
          </select>
          <span class="config-hint">Nano √© recomendado para a maioria dos casos</span>
        </div>

        <div class="config-field">
          <label class="config-label" for="cfg-confidence">
            Confian√ßa m√≠nima: <strong id="cfg-confidence-val">0.50</strong>
          </label>
          <input type="range" id="cfg-confidence" class="config-range"
                 min="0.1" max="0.95" step="0.05" value="0.5"
                 oninput="document.getElementById('cfg-confidence-val').textContent = parseFloat(this.value).toFixed(2)" />
          <div class="config-range-labels"><span>0.10 (mais detec√ß√µes)</span><span>0.95 (s√≥ certezas)</span></div>
        </div>

        <div class="config-field">
          <label class="config-label" for="cfg-output">Pasta de sa√≠da</label>
          <input type="text" id="cfg-output" class="config-input" value="jogadores_terca"
                 placeholder="Nome da pasta onde as imagens ser√£o salvas" />
          <span class="config-hint">Relativa √† raiz do projeto</span>
        </div>

      </div>
    </div><!-- /step-2 -->

    <!-- ‚ïê‚ïê‚ïê ETAPA 3 ‚Äî Iniciar captura ‚ïê‚ïê‚ïê -->
    <div class="step-section" id="step-3">
      <div class="step-header">
        <div class="step-number-badge">3</div>
        <div class="step-info">
          <div class="step-title">Iniciar captura</div>
          <div class="step-desc">Processe os v√≠deos e extraia imagens dos jogadores em background</div>
        </div>
      </div>

    <!-- ---- Bot√£o PROCESSAR ---- -->
    <div class="processar-section">
      <button class="btn-processar" id="btn-processar" onclick="processarVideos()" disabled>
        üöÄ Iniciar Captura de Imagens
      </button>
      <button class="btn-parar hidden" id="btn-parar" onclick="pararCaptura()">
        ‚èπ Parar Captura
      </button>
      <p class="processar-hint">
        O script roda em background (pode demorar v√°rios minutos).
        Acompanhe o progresso no terminal ou nos logs.
      </p>
    </div>

    <!-- ---- Status ---- -->
    <div id="status-box" class="status-box hidden">
      <div class="status-header">
        <span id="status-icon">‚öôÔ∏è</span>
        <strong id="status-title">Processando‚Ä¶</strong>
        <span id="status-badge" class="status-badge hidden"></span>
        <span class="status-spacer"></span>
        <div id="status-counters" class="status-counters hidden">
          <div class="counter-item">
            <div id="counter-new"  class="counter-value">0</div>
            <div class="counter-label">novas capturas</div>
          </div>
          <div class="counter-divider"></div>
          <div class="counter-item">
            <div id="counter-total" class="counter-value">‚Äî</div>
            <div class="counter-label">total no banco</div>
          </div>
        </div>
      </div>
      <pre id="status-msg" class="status-msg"></pre>
      <div id="status-log-wrap" class="status-log-wrap hidden">
        <div class="log-header">
          <span>üìã Log do script</span>
          <label class="log-autoscroll">
            <input type="checkbox" id="log-autoscroll" checked /> auto-scroll
          </label>
        </div>
        <pre id="status-log" class="status-log"></pre>
      </div>
    </div><!-- /status-box -->
    </div><!-- /step-3 -->

    <!-- ---- Hist√≥rico de capturas (colaps√°vel) ---- -->
    <div class="section-card collapsible-card" id="card-historico">
      <div class="section-header collapsible-trigger" onclick="toggleHistorico()">
        <h2 class="section-title">üïì Hist√≥rico de Capturas <span id="historico-count" class="lista-count"></span></h2>
        <div class="section-header-actions">
          <button class="btn-refresh" onclick="event.stopPropagation(); carregarHistorico(true)">üîÑ Atualizar</button>
          <span class="collapse-chevron" id="historico-chevron">‚ñº</span>
        </div>
      </div>
      <div id="historico-wrap" class="collapsible-body collapsed">
        <div class="loading-row">Carregando‚Ä¶</div>
      </div>
    </div>

  </div><!-- /videos-container -->

  <script src="/static/js/videos.js"></script>
</body>
</html>
